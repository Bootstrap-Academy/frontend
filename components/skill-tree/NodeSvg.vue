<template>
  <svg
    viewBox="0 0 301 301"
    :width="size"
    :height="size"
    fill="none"
    xmlns="http://www.w3.org/2000/svg"
    class="group cursor-pointer relative outline-none"
    @click="onclickToggleActive"
    role="button"
    tabindex="0"
  >
    <path
      id="dashed"
      d="M150.03 300.372C147.359 300.372 144.66 300.286 141.961 300.144L142.103 297.299C146.819 297.555 151.536 297.555 156.167 297.385L156.28 300.229C154.206 300.343 152.104 300.372 150.03 300.372ZM170.543 298.978L170.145 296.161C174.776 295.535 179.436 294.653 183.982 293.601L184.635 296.36C180.004 297.441 175.259 298.323 170.543 298.978ZM127.698 298.722C122.982 298.01 118.265 297.072 113.634 295.934L114.316 293.174C118.862 294.312 123.493 295.222 128.096 295.905L127.698 298.722ZM198.415 292.377L197.506 289.675C201.938 288.167 206.342 286.431 210.575 284.497L211.74 287.086C207.422 289.077 202.933 290.841 198.415 292.377ZM99.9114 291.78C95.4224 290.187 90.9617 288.366 86.6431 286.346L87.8364 283.757C92.0698 285.749 96.4452 287.541 100.849 289.106L99.9114 291.78ZM224.497 280.571L223.077 278.096C227.139 275.763 231.117 273.202 234.924 270.528L236.572 272.861C232.708 275.621 228.645 278.209 224.497 280.571ZM73.9715 279.66C69.8802 277.242 65.8457 274.596 61.9817 271.78L63.658 269.475C67.4368 272.235 71.4144 274.824 75.4205 277.185L73.9715 279.66ZM247.88 264.013L246.033 261.851C249.585 258.807 253.023 255.535 256.233 252.15L258.279 254.113C254.983 257.583 251.488 260.912 247.88 264.013ZM50.7875 262.818C47.236 259.66 43.7698 256.303 40.5024 252.804L42.5765 250.869C45.787 254.283 49.168 257.583 52.6627 260.684L50.7875 262.818ZM267.711 243.33L265.495 241.566C268.393 237.896 271.149 234.056 273.678 230.129L276.064 231.666C273.479 235.649 270.666 239.575 267.711 243.33ZM31.2117 241.879C28.3137 238.095 25.5294 234.141 23.0007 230.101L25.4157 228.593C27.916 232.548 30.6151 236.445 33.4847 240.144L31.2117 241.879ZM283.253 219.262L280.724 217.953C282.883 213.799 284.844 209.475 286.605 205.151L289.248 206.203C287.458 210.613 285.44 215.023 283.253 219.262ZM15.9546 217.612C13.8238 213.344 11.8633 208.934 10.1302 204.496L12.7725 203.472C14.4488 207.825 16.3808 212.149 18.4833 216.331L15.9546 217.612ZM293.936 192.661L291.208 191.865C292.515 187.398 293.651 182.789 294.532 178.18L297.316 178.721C296.436 183.387 295.299 188.081 293.936 192.661ZM5.58433 190.897C4.3058 186.317 3.22614 181.594 2.37379 176.9L5.15815 176.388C5.98209 180.997 7.03333 185.606 8.31186 190.101L5.58433 190.897ZM299.362 164.496L296.521 164.24C296.947 159.603 297.174 154.88 297.174 150.186H300.016C300.016 154.937 299.788 159.773 299.362 164.496ZM0.527038 162.675C0.186097 158.522 0.015625 154.311 0.015625 150.157V148.337L2.8568 148.365V150.157C2.8568 154.254 3.02727 158.379 3.36822 162.448L0.527038 162.675ZM296.833 139.66C296.521 134.994 295.953 130.3 295.186 125.691L297.998 125.236C298.794 129.93 299.362 134.738 299.675 139.489L296.833 139.66ZM3.68075 134.311L0.867965 133.998C1.37938 129.247 2.1181 124.496 3.05568 119.83L5.84003 120.399C4.93085 124.979 4.19216 129.674 3.68075 134.311ZM292.174 111.921C290.952 107.398 289.532 102.903 287.884 98.5213L290.554 97.5255C292.231 101.992 293.68 106.573 294.93 111.181L292.174 111.921ZM9.33469 106.772L6.60716 105.947C7.99933 101.395 9.64721 96.8427 11.4656 92.433L14.0794 93.5141C12.3179 97.8385 10.6985 102.305 9.33469 106.772ZM282.343 85.6051C280.298 81.423 278.025 77.2693 275.581 73.2579L277.997 71.7786C280.497 75.8469 282.798 80.0859 284.901 84.3533L282.343 85.6051ZM20.1311 80.7971L17.6309 79.46C19.8755 75.2494 22.3473 71.1242 24.9896 67.1412L27.3477 68.706C24.7623 72.632 22.3473 76.7004 20.1311 80.7971ZM267.655 61.622C264.842 57.8951 261.83 54.2251 258.676 50.7827L260.779 48.8766C263.989 52.4043 267.058 56.1028 269.928 59.915L267.655 61.622ZM35.7008 57.383L33.4847 55.5907C36.4963 51.8922 39.7069 48.2791 43.0311 44.8936L45.0483 46.8851C41.7809 50.2137 38.6272 53.7414 35.7008 57.383ZM248.704 40.8537C245.238 37.7243 241.573 34.7086 237.851 31.9205L239.555 29.6446C243.363 32.4895 247.084 35.5621 250.636 38.7485L248.704 40.8537ZM55.3902 37.2975L53.5718 35.1069C57.2085 32.0344 61.0441 29.104 64.965 26.4013L66.5844 28.7342C62.7204 31.4369 58.9701 34.3103 55.3902 37.2975ZM226.173 24.04C222.167 21.6218 218.019 19.3458 213.814 17.3259L215.036 14.7654C219.326 16.8422 223.56 19.1466 227.651 21.5933L226.173 24.04ZM78.5174 21.3373L77.1252 18.8621C81.2733 16.5293 85.5919 14.3955 89.9673 12.4894L91.1038 15.1068C86.8136 16.956 82.5803 19.0613 78.5174 21.3373ZM200.858 11.8351C196.483 10.2134 191.966 8.79095 187.448 7.62452L188.158 4.8649C192.761 6.08824 197.364 7.51072 201.824 9.1608L200.858 11.8351ZM104.23 10.0712L103.349 7.36847C107.895 5.88908 112.526 4.60885 117.157 3.58467L117.782 6.37273C113.237 7.36847 108.691 8.62026 104.23 10.0712ZM173.697 4.6942C169.094 3.95451 164.406 3.41396 159.718 3.10102L159.917 0.256048C164.662 0.568994 169.463 1.10955 174.151 1.87769L173.697 4.6942ZM131.647 3.92606L131.306 1.10955C136.023 0.512103 140.824 0.142248 145.598 0L145.683 2.84497C140.995 2.98722 136.279 3.35707 131.647 3.92606Z"
      fill="var(--dashed-color)"
      class="transformation group-focus:scale-100 group-focus:opacity-100"
      :class="dashed.scale"
    />

    <g id="icon-box" class="cursor-pointer">
      <foreignObject
        x="43.8984"
        y="44.0664"
        :width="iconSize"
        :height="iconSize"
        class="cursor-pointer"
      >
        <!-- <object
					class="cursor-pointer"
					type="image/svg+xml"
					:data="icon"
					v-if="node && node.icon"
					@click="onclickToggleActive"
				></object> -->

        <img :src="icon" class="cursor-pointer" v-if="node && node.icon" />
      </foreignObject>
    </g>

    <path
      v-if="outline.show"
      id="outline"
      d="M273.977 150.187C273.977 218.709 218.476 274.257 150.012 274.257C81.5479 274.257 26.0469 218.709 26.0469 150.187C26.0469 81.6652 81.5479 26.1172 150.012 26.1172C218.476 26.1172 273.977 81.6652 273.977 150.187ZM27.9063 150.187C27.9063 217.681 82.5749 272.396 150.012 272.396C217.449 272.396 272.117 217.681 272.117 150.187C272.117 82.693 217.449 27.9782 150.012 27.9782C82.5749 27.9782 27.9063 82.693 27.9063 150.187Z"
      fill="var(--outline-color)"
      class="transformation group-focus:scale-150"
      :class="outline.scale"
    />

    <g
      id="half"
      v-if="half.show"
      class="transformation group-focus:rotate-[225deg] group-focus:group-hover:rotate-[225deg]"
      :class="half.rotate"
    >
      <path
        d="M27.4856 151.185C24.8705 151.185 22.7413 153.305 22.8392 155.919C23.4002 170.899 26.6206 185.673 32.3622 199.546C38.7078 214.879 48.0087 228.811 59.7338 240.546C71.459 252.281 85.3787 261.59 100.698 267.941C114.557 273.686 129.316 276.909 144.281 277.471C146.897 277.57 149.019 275.439 149.019 272.821C149.019 270.204 146.897 268.092 144.281 267.986C130.56 267.428 117.032 264.453 104.322 259.184C90.1518 253.309 77.276 244.699 66.4302 233.844C55.5845 222.989 46.9812 210.102 41.1115 195.919C35.8459 183.196 32.8727 169.654 32.3165 155.918C32.2107 153.305 30.1008 151.185 27.4856 151.185Z"
        fill="var(--half-color)"
      />
      <path
        d="M272.553 149.185C275.168 149.185 277.297 147.064 277.2 144.451C276.638 129.47 273.418 114.696 267.676 100.823C261.331 85.49 252.03 71.5585 240.305 59.8234C228.58 48.0883 214.66 38.7796 199.34 32.4286C185.481 26.6832 170.722 23.4602 155.757 22.8978C153.142 22.7995 151.019 24.9306 151.019 27.5479C151.019 30.1652 153.142 32.2769 155.757 32.3832C169.478 32.9407 183.006 35.9162 195.716 41.1853C209.887 47.0599 222.763 55.6705 233.608 66.5255C244.454 77.3804 253.058 90.2671 258.927 104.45C264.193 117.173 267.166 130.715 267.722 144.451C267.828 147.064 269.938 149.185 272.553 149.185Z"
        fill="var(--half-color)"
      />
    </g>
  </svg>
</template>

<script lang="ts">
import { defineComponent } from "vue";
import type { PropType } from "vue";

export default {
  props: {
    node: { type: Object as PropType<any>, default: null },
    size: { type: Number, default: 200 },
    disabled: { type: Boolean, default: false },
    active: { type: Boolean, default: false },
    completed: { type: Boolean, default: false },
    failed: { type: Boolean, default: false },
  },
  emits: ["active", "completed"],
  setup(props, { emit }) {
    function onclickToggleActive() {
      if (!props.active && !props.completed) {
        emit("active", true);
        emit("completed", false);
      } else if (props.active && !props.completed) {
        emit("active", false);
        emit("completed", true);
      } else {
        emit("active", false);
        emit("completed", false);
      }
    }
    function ondblclickToggleCompleted() {
      emit("completed", !props.completed);
    }
    const normal = computed(() => {
      return !(
        props.disabled ||
        props.active ||
        props.completed ||
        props.failed
      );
    });

    const dashed = computed(() => {
      return {
        show: !(props.disabled || props.failed || normal.value),
        // opacity: props.active ? 'opacity-100' : 'opacity-30',
        scale:
          props.active || props.completed
            ? "scale-100 opacity-100"
            : "scale-0 opacity-0",
      };
    });

    const outline = computed(() => {
      return {
        show: !props.disabled,
        scale: props.completed ? "scale-150" : "scale-100",
      };
    });

    const half = computed(() => {
      let rotate = "";

      if (props.failed) rotate = "rotate-45 group-hover:rotate-45 ";
      else if (props.active)
        rotate = "rotate-[135deg] group-hover:rotate-[135deg]";
      else if (props.completed)
        rotate = "rotate-[225deg] group-hover:rotate-[225deg]";
      else rotate = "rotate-0 group-hover:rotate-45 ";

      return {
        show: !props.disabled,
        rotate: rotate,
      };
    });

    const icon = computed(() => {
      return `/svgs/${props.node?.icon ?? "Algorithmic"}.svg`;
    });

    const iconSize = computed(() => {
      return 212.235;
    });
    const iconPosition = computed(() => {
      return iconSize.value * 0.4;
    });
    const iconViewBox = computed(() => {
      return `0 0 ${iconSize.value} ${iconSize.value}`;
    });

    return {
      dashed,
      outline,
      half,
      onclickToggleActive,
      icon,
      iconSize,
      iconPosition,
      iconViewBox,
    };
  },
};
</script>

<style scoped>
.transformation {
  @apply origin-center transition-all duration-500 ease-in-out;
}
svg {
  --dashed-color: #00ffff;
  --half-color: #0cc9ab;
  --icon-bg: #0e425e;
  --icon-primary: #c5fff6;
  --icon-secondary: #0cc9ab;
  --outline-color: #00ffff;
  --size: 200px;
  /* width: var(--size); */
  /* height: var(--size); */
}

svg #icon-box {
}
/* svg:hover #half {
	transform: rotate(45deg);
} */
svg #dashed {
}
svg #outline {
}
</style>
